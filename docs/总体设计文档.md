# 总体设计文档

## 项目名称 / 文档作者

- 项目名称：Bookstore书店管理系统

- 文档作者：唐哲宇(Towns)

## 程序功能概述

- 书店管理系统是一个高性能、基于 C++ 实现的命令行（CLI）应用程序。它设计有严格的权限分级和嵌套登录机制，确保操作的安全性和隔离性。

- 核心功能帐户管理： 支持用户的注册、登录（su）、注销（logout）以及由高权限用户进行的帐户创建（useradd）和删除（delete）。

- 图书管理与交易： 提供全面的图书信息查询（show），支持顾客购买（buy）以及员工对图书信息（modify）、库存（import）的管理。

- 日志与财务： 仅限店主（{7} 权限）访问，用于查询财务收支（show finance）、系统操作日志（log），并生成财务和员工工作报告。

- 性能要求： 系统严格遵守数据持久化原则，所有主体数据都实时存储在文件中，禁止驻留内存。为确保高效检索，系统采用基于文件的索引结构（如 B+ 树）来管理 $UserID$ 和 $ISBN$ 等关键数据。首次运行时会自动初始化并创建超级管理员账户 root。

## 主题逻辑说明

### 类、模块、其对外接口，以及调用关系

- `Lexer`模块
- - 功能：接收语句源代码，并解析为`TokenStream`类
- - 对外接口：
```cpp
TokenStream Tokenize(std::string line);
```
- - 关联模块：`Parser`模块(会消费`Lexer`解析出来的`TokenStream`)，`main函数`

- `Parser`模块
- - 功能：接受`Lexer`解析出的`TokenStream`,并转化为对应的`Statement`
- - 对外接口：
```cpp
Statement parseLine(TokenStream& tokens);
```
- - 关联模块和类：`Lexer`模块(消费`Lexer`模块解析出的`TokenStream`)、`Statement`类(判断并解析为对应`Statement`)

- `Statement`类（抽象类）
- - 功能：存储语句信息和展示语句类型
- - 对外接口：
```cpp
void execute();
```
- - 关联模块：

- `LogManager`模块

- `BookManager`模块

- `AccountManager`模块

- `FinanceManager`模块

- `BlockList`模块

- 
