# 需求分析文档

## 业务流图
```mermaid
graph TD
    Start[系统启动] --> IfFirstMove{首次运行?};
    IfFirstMove -->|是| Initialise[初始化];
    IfFirstMove -->|否| NoInitialise[无];
    Initialise --> Guest[进入游客状态];
    NoInitialise --> Guest[进入游客状态];
    Guest --> GuestOpt{游客操作};
    GuestOpt -->|注册| CreatAccount[创建顾客账户];
    GuestOpt -->|登录| SignIn[加入登录栈并切换为对应角色状态];
    CreatAccount --> Guest;
    SignIn --> NowRole{当前角色};
    NowRole -->|顾客| CustomerOpt{顾客操作};
    NowRole -->|销售人员| StaffOpt{销售人员操作};
    NowRole -->|店长| ManagerOpt{店长操作};
    
    CustomerOpt -->|查询图书| FindBook[返回图书列表];
    CustomerOpt -->|购买图书| BuyBook[扣减图书库存，写入销售文件];
    CustomerOpt -->|退登| SignOut[切换至上一角色/游客状态];
    FindBook --> CustomerOpt;
    BuyBook --> CustomerOpt;
    SignOut --> Guest;
    
    StaffOpt -->|继承顾客所有操作| CustomerOpt;
    StaffOpt -->|录入图书信息| TypeInBookInformations[写入图书文件];
    StaffOpt -->|修改图书信息| ModifyBookInformations[更新图书文件];
    StaffOpt -->|进货图书| StockBook[增加图书库存 ];
    StaffOpt -->|创建顾客账户| CreatCustomerAccount[创建账户文件];
    StaffOpt -->|退登| SignOut;
    TypeInBookInformations --> StaffOpt;
    ModifyBookInformations --> StaffOpt;
    StockBook --> StaffOpt;
    CreatCustomerAccount --> StaffOpt;
    
    ManagerOpt -->|继承销售人员所有操作| StaffOpt;
    ManagerOpt -->|查询采购| FindBuyingList[按采购顺序输出];
    ManagerOpt -->|查询销售| FindSellingList[按销售顺序输出];
    ManagerOpt -->|查询盈利| FindProfitList[输出盈利];
    ManagerOpt -->|查看员工工作报告| FindStaffRecord[输出某员工工作报告];
    ManagerOpt -->|查看工作日志| FindDailyRecord[输出工作日志出];
    ManagerOpt -->|退登| SignOut;
    FindBuyingList --> ManagerOpt;
    FindSellingList --> ManagerOpt;
    FindProfitList --> ManagerOpt;
    FindStaffRecord --> ManagerOpt;
    FindDailyRecord --> ManagerOpt;
```
## 数据流图
```mermaid
graph TD
    User[用户]
    ExternalFile[外存文件]
    
    P1[账户管理模块]
    P2[图书管理模块]
    P3[采购销售模块]
    P4[数据统计模块]
    P5[日志管理模块]
    
    User -->|注册/登录/退出指令| P1;
    P1 -->|返回操作反馈| User;
    P1 -->|读取/写入账户文件| ExternalFile;
    ExternalFile -->|账户数据 -> 返回账户信息| P1;
    
    User -->|查询/录入/修改/进货/购买指令| P2;
    P2 -->|操作反馈| User;
    P2 -->|读取/写入图书文件| ExternalFile;
    ExternalFile -->|图书数据| P2;
    
    P2 -->|进货指令| P3;
    P2 -->|购买指令| P3;
    P3 -->|采购/销售记录| ExternalFile;
    ExternalFile -->|采购/销售数据| P3;
    P3 -->|采购/销售操作结果| User;
    
    User -->|统计查询指令（店长| P4;
    P4 -->|读取采购/销售数据| ExternalFile;
    ExternalFile -->|采购/销售数据| P4;
    P4 -->|盈利/采购/销售统计信息| User;
    
    P1 -->|账户操作日志| P5;
    P2 -->|图书操作日志| P5;
    P3 -->|采购/销售操作日志| P5;
    P4 -->|统计操作日志| P5;
    P5 -->|日志数据| ExternalFile;
    ExternalFile -->|日志数据| P5;
    User -->|日志查询指令（店长）| P5;
    P5 -->|员工报告/系统日志信息| User;
```

## 数据词典

| 文件名称 | 数据结构列表 | 存储介质 | 说明 |
| --- | --- | --- | --- |
| 账户文件（account.txt） | {账户名（account_name）、密码（password）、角色（role）、创建时间（create_time）} | 硬盘 | 存储所有账户的信息，支持账户注册、登录、权限判断等操作的数据读写 |
| 图书文件（book.txt） | {ISBN（isbn）、书名（book_name）、作者（author）、关键字（keywords）、库存量（stock）、单价（price）、最后更新时间（update_time）、进价（purchase_price）} | 硬盘 | 存储所有图书的信息，支持图书录入、修改、查询、进货、购买等操作的数据读写 |
| 采购文件（purchase.txt） | {采购 ID（purchase_id，自增）、ISBN（isbn）、进货数量（purchase_num）、进货价格（purchase_price）、进货时间（purchase_time）、操作账户（operate_account）} | 硬盘 | 存储所有图书的进货记录，支持采购信息查询、盈利计算等操作的数据读写 |
| 销售文件（sale.txt） | {销售 ID（sale_id，自增）、ISBN（isbn）、销售数量（sale_num）、销售单价（sale_price）、销售时间（sale_time）、操作账户（operate_account）} | 硬盘 | 存储所有图书的销售记录，支持销售信息查询、盈利计算等操作的数据读写 |

## 功能说明

### 系统基础模块

系统启动与初始化的核心模块，无角色权限限制，为系统运行提供基础支撑。

|功能名称|输入参数|输出参数|
|---|---|---|---|
|系统启动检测|无|启动状态提示、首次运行标识|
|首次运行初始化|无|初始化成功提示 |
|非首次运行加载|无|数据加载成功/失败提示|

### 账户管理模块

负责账户的注册、登录、退出及权限控制，不同角色拥有不同操作权限。

|功能名称|权限角色|输入参数|输出参数|
|---|---|---|---|
|游客注册顾客账户|游客|account_name、password|注册成功/失败|
|账户登录|所有角色（游客触发）|account_name、password|登录成功/失败提示、当前角色、登录栈状态|
|退登|已登录角色（顾客/销售人员/店长）|无|退出成功提示、切换后角色/游客状态|
|创建顾客账户（后台）|销售人员/店长|account_name、password|创建成功/失败|
|账户密码修改|已登录角色（顾客/销售人员/店长）|old_password、new_password|修改成功/失败|

### 图书管理模块

核心业务模块，涵盖图书的查询、录入、修改、进货、购买等操作，权限随角色递增。

|功能名称|权限角色|输入参数|输出参数|
|---|---|---|---|
|图书多条件查询|顾客/销售人员/店长|可选参数组合：isbn、--name、--author、--keywords|匹配图书/ 无匹配提示|
|图书信息录入|销售人员/店长|isbn、book_name、author、keywords、stock、price|录入成功/失败|
|图书信息修改|销售人员/店长|isbn、待修改字段及对应值|修改成功/失败提示、修改后完整图书信息|
|图书进货|销售人员/店长|isbn、purchase_num、purchase_price|进货成功/失败提示、更新后库存量、进货总金额|
|图书购买|顾客/销售人员/店长|isbn、sale_num（整型）|购买成功/失败、消费总金额、剩余库存量|

### 数据统计模块

仅店长可操作，用于采购、销售、盈利数据的统计查询及员工工作监管。

|功能名称|权限角色|输入参数|输出参数|
|---|---|---|---|
|采购记录查询|店长|start_time、end_time|时间段采购记录列表 / 无记录|
|销售记录查询|店长|start_time、end_time|时间段销售记录列表 / 无记录|
|盈利数据统计|店长|start_time、end_time|销售收入、采购支出、利润|
|员工工作报告查询|店长|staff_account、start_time、end_time|员工操作记录列表/ 无记录|
|系统日志查询|店长|start_time、end_time|系统操作日志列表/ 无记录|

## 用户交互设计
### 游客

|命令格式|
|---|
|register <account_name> <password>|
|login <account_name> <password>|
### 顾客（继承游客）

|命令格式|
|---|
|query_book [--isbn <isbn>] <book_name> <author> <keywords>|
|buy_book <isbn> <sale_num>|
|change_pwd <old_password> <new_password>|
### 销售人员（继承顾客）

|命令格式|
|---|
|add_book <isbn> <book_name> <author> <keywords> <stock> <price>|
|modify_book <isbn> <book_name> <author> <keywords> <price>|
|purchase_book <isbn> <purchase_num> <purchase_price>|
|create_customer <account_name> <password>|
### 店长（继承销售人员）

|命令格式|
|---|
|stat_purchase <start_time> <end_time>|
|stat_sale <start_time> <end_time>|
|stat_profit <start_time> <end_time>|
|query_staff_log <staff_account> <start_time> <end_time>|
|query_system_log <start_time> <end_time>|